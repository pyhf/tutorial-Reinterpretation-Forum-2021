
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Workspace Manipulations &#8212; LHC Reinterpretation Forum Workshop 2021 pyhf Tutorial</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modifiers" href="Modifiers.html" />
    <link rel="prev" title="HistFactory" href="IntroToHiFa.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">LHC Reinterpretation Forum Workshop 2021 pyhf Tutorial</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   LHC Reinterpretation Forum Workshop 2021 pyhf Tutorial
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Get started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="HelloWorld.html">
   My First Likelihood
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SimpleWorkspace.html">
   Workspace World
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SerializationAndPatching.html">
   Using HEPData
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Common use and applications
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="PullPlot.html">
   Making a Pull Plot
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Toys.html">
   Playing with Toys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Combinations.html">
   Performing a Combination
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  More Information
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="IntroToHiFa.html">
   HistFactory
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Workspace Manipulations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Modifiers.html">
   Modifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="UsingCalculators.html">
   Using Calculators
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Learn Fundamentals
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="InterpolationCodes.html">
   Piecewise Linear Interpolation
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/WorkspaceManipulations.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/pyhf/tutorial-Reinterpretation-Forum-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/pyhf/tutorial-Reinterpretation-Forum-2021/issues/new?title=Issue%20on%20page%20%2FWorkspaceManipulations.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/pyhf/tutorial-Reinterpretation-Forum-2021/edit/main/book/WorkspaceManipulations.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/pyhf/tutorial-Reinterpretation-Forum-2021/main?urlpath=lab/tree/book/WorkspaceManipulations.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/pyhf/tutorial-Reinterpretation-Forum-2021/blob/main/book/WorkspaceManipulations.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-the-xml-root">
   Getting the XML+ROOT
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#xml-to-json">
   XML to JSON
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#via-the-command-line">
     via the command line
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#via-the-python-interface">
     via the python interface
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#workspace-inspection">
   Workspace Inspection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#normalizing-a-workspace">
   ‚ÄúNormalizing‚Äù a Workspace
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-a-digest">
   Computing a digest
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pruning-away-items">
   ‚ÄúPruning‚Äù away items
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prune-channels">
     prune channels
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prune-samples">
     prune samples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prune-modifiers">
     prune modifiers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prune-modifier-types">
     prune modifier types
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#renaming-items">
   Renaming items
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rename-channels">
     rename channels
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rename-samples">
     rename samples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rename-modifiers">
     rename modifiers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rename-measurements">
     rename measurements
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="workspace-manipulations">
<h1>Workspace Manipulations<a class="headerlink" href="#workspace-manipulations" title="Permalink to this headline">¬∂</a></h1>
<p>In this chapter, you will learn about various workspace manipulations including how to convert from HistFactory XML+ROOT workspaces to pyhf. We‚Äôll cover some common pitfalls such as locations of root files, and being able to set the base path for the conversion.</p>
<div class="section" id="getting-the-xml-root">
<h2>Getting the XML+ROOT<a class="headerlink" href="#getting-the-xml-root" title="Permalink to this headline">¬∂</a></h2>
<p>Note, getting the XML+ROOT won‚Äôt necessarily be covered as part of the tutorial.</p>
<p>If you want to practice extracting out the HistFactory files from the workspace, first create the workspace like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ hist2workspace config/example.xml

... lots of output! ...
</pre></div>
</div>
<p>and you‚Äôll notice a few new files being made!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls results/
total 136K
drwxr-xr-x 7 kratsg 224 Sep 23 16:32 ./
drwxr-xr-x 5 kratsg 160 Sep 23 16:33 ../
-rw-r--r-- 1 kratsg 503 Sep 23 16:32 example_GaussExample.root
-rw-r--r-- 1 kratsg 40K Sep 23 16:32 example_channel1_GaussExample_model.root
-rw-r--r-- 1 kratsg 38K Sep 23 16:32 example_channel2_GaussExample_model.root
-rw-r--r-- 1 kratsg 48K Sep 23 16:32 example_combined_GaussExample_model.root
-rw-r--r-- 1 kratsg  26 Sep 23 16:32 example_results.table
</pre></div>
</div>
<p>In particular, <code class="docutils literal notranslate"><span class="pre">example_combined_GaussExample_model.root</span></code> is exactly the file that contains the <code class="docutils literal notranslate"><span class="pre">RooStats::HistFactory::Measurement</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ root results/example_combined_GaussExample_model.root 
   ------------------------------------------------------------
  | Welcome to ROOT 6.18/04                  https://root.cern |
  |                               (c) 1995-2019, The ROOT Team |
  | Built for macosx64 on Sep 11 2019, 15:38:23                |
  | From tags/v6-18-04@v6-18-04                                |
  | Try &#39;.help&#39;, &#39;.demo&#39;, &#39;.license&#39;, &#39;.credits&#39;, &#39;.quit&#39;/&#39;.q&#39; |
   ------------------------------------------------------------

root [0] 
Attaching file results/example_combined_GaussExample_model.root as _file0...

RooFit v3.60 -- Developed by Wouter Verkerke and David Kirkby 
                Copyright (C) 2000-2013 NIKHEF, University of California &amp; Stanford University
                All rights reserved, please read http://roofit.sourceforge.net/license.txt

(TFile *) 0x7ffaa30d2130
root [1] .ls
TFile**		results/example_combined_GaussExample_model.root	
 TFile*		results/example_combined_GaussExample_model.root	
  KEY: RooWorkspace	combined;1	combined
  KEY: TProcessID	ProcessID0;1	e1e9272e-fddb-11ea-86b3-1556a8c0beef
  KEY: TDirectoryFile	channel1_hists;1	channel1_hists
  KEY: TDirectoryFile	channel2_hists;1	channel2_hists
  KEY: RooStats::HistFactory::Measurement	GaussExample;1
</pre></div>
</div>
<p>from which you can extract out the necessary XML files as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">GaussExample</span><span class="o">-&gt;</span><span class="n">PrintXML</span><span class="p">()</span>
<span class="n">Printing</span> <span class="n">XML</span> <span class="n">Files</span> <span class="k">for</span> <span class="n">measurement</span><span class="p">:</span> <span class="n">GaussExample</span>
<span class="n">Printing</span> <span class="n">XML</span> <span class="n">Files</span> <span class="k">for</span> <span class="n">channel</span><span class="p">:</span> <span class="n">channel1</span>
<span class="n">Finished</span> <span class="n">printing</span> <span class="n">XML</span> <span class="n">files</span>
<span class="n">Printing</span> <span class="n">XML</span> <span class="n">Files</span> <span class="k">for</span> <span class="n">channel</span><span class="p">:</span> <span class="n">channel2</span>
<span class="n">Finished</span> <span class="n">printing</span> <span class="n">XML</span> <span class="n">files</span>
<span class="n">Finished</span> <span class="n">printing</span> <span class="n">XML</span> <span class="n">files</span>
</pre></div>
</div>
<p>which dumps them into the same directory you ran from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls
total 12K
drwxr-xr-x 8 kratsg  256 Sep 23 16:32 ./
drwxr-xr-x 4 kratsg  128 Sep 22 15:10 ../
-rw-r--r-- 1 kratsg  459 Sep 23 16:32 GaussExample.xml
-rw-r--r-- 1 kratsg 1.1K Sep 23 16:32 GaussExample_channel1.xml
-rw-r--r-- 1 kratsg  795 Sep 23 16:32 GaussExample_channel2.xml
drwxr-xr-x 6 kratsg  192 Sep 22 15:10 config/
drwxr-xr-x 3 kratsg   96 Sep 22 15:10 data/
drwxr-xr-x 7 kratsg  224 Sep 23 16:32 results/
</pre></div>
</div>
</div>
<div class="section" id="xml-to-json">
<h2>XML to JSON<a class="headerlink" href="#xml-to-json" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="via-the-command-line">
<h3>via the command line<a class="headerlink" href="#via-the-command-line" title="Permalink to this headline">¬∂</a></h3>
<p>So pyhf comes with a lot of nifty utilities you can access. The documentation for the command line can be found via <code class="docutils literal notranslate"><span class="pre">pyhf</span> <span class="pre">--help</span></code> or <a class="reference external" href="https://pyhf.readthedocs.io/en/v0.6.0/cli.html">online</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pyhf --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: pyhf [OPTIONS] COMMAND [ARGS]...

  Top-level CLI entrypoint.

Options:
  --version           Show the version and exit.
  --cite, --citation  Print the bibtex citation for this software
  -h, --help          Show this message and exit.

Commands:
  cls          Compute CLs value(s) for a given pyhf workspace.
  combine      Combine two workspaces into a single workspace.
  completions  Generate shell completion code.
  contrib      Contrib experimental operations.
  digest       Use hashing algorithm to calculate the workspace digest.
  fit          Perform a maximum likelihood fit for a given pyhf workspace.
  inspect      Inspect a pyhf JSON document.
  json2xml     Convert pyhf JSON back to XML + ROOT files.
  patchset     Operations involving patchsets.
  prune        Prune components from the workspace.
  rename       Rename components of the workspace.
  sort         Sort the workspace.
  xml2json     Entrypoint XML: The top-level XML file for the PDF...
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs focus for now on <code class="docutils literal notranslate"><span class="pre">pyhf</span> <span class="pre">xml2json</span></code> which requires that you have installed <code class="docutils literal notranslate"><span class="pre">pyhf[xmlio]</span></code> (pyhf with the xmlio option).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pyhf</span><span class="p">[</span><span class="n">xmlio</span><span class="p">]</span>
</pre></div>
</div>
<p>Again, the online documentation for this option is found <a class="reference external" href="https://pyhf.readthedocs.io/en/v0.6.0/cli.html#pyhf-xml2json">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pyhf xml2json --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: pyhf xml2json [OPTIONS] ENTRYPOINT_XML

  Entrypoint XML: The top-level XML file for the PDF definition.

Options:
  --basedir PATH                  The base directory for the XML files to
                                  point relative to.

  --output-file TEXT              The location of the output json file. If not
                                  specified, prints to screen.

  --track-progress / --hide-progress
  -h, --help                      Show this message and exit.
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs remind ourselves of what the top-level XML file looks like, as this is the <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT_XML</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tail -n +15 data/multichannel_histfactory/config/example.xml <span class="p">|</span> cat -n
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     1	&lt;!DOCTYPE Combination  SYSTEM &#39;HistFactorySchema.dtd&#39;&gt;
     2	
     3	&lt;Combination OutputFilePrefix=&quot;./results/example&quot;&gt;
     4	  &lt;Input&gt;./config/example_signal.xml&lt;/Input&gt;
     5	  &lt;Input&gt;./config/example_control.xml&lt;/Input&gt;
     6	  &lt;Measurement Name=&quot;GaussExample&quot; Lumi=&quot;1.&quot; LumiRelErr=&quot;0.1&quot; ExportOnly=&quot;True&quot;&gt;
     7	    &lt;POI&gt;SigXsecOverSM&lt;/POI&gt;
     8	    &lt;ParamSetting Const=&quot;True&quot;&gt;Lumi&lt;/ParamSetting&gt;
     9	  &lt;/Measurement&gt;
    10	&lt;/Combination&gt;
</pre></div>
</div>
</div>
</div>
<p>So to explain these options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">basedir</span></code> specifies the base directory for where all the XML files are reference with respect to. As you can see from lines 3, 4, 5 - this should be the directory containing <code class="docutils literal notranslate"><span class="pre">results/</span></code> and <code class="docutils literal notranslate"><span class="pre">config/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output-file</span></code> specifies the output JSON file. If one is not specified, this will print to the screen, which you can redirect into a file if you want (<code class="docutils literal notranslate"><span class="pre">pyhf</span> <span class="pre">xml2json</span> <span class="pre">...</span> <span class="pre">&gt;</span> <span class="pre">workspace.json</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hide-progress</span></code> will disable showing the progress bars when running the script‚Ä¶ but we like progress bars üôÇ</p></li>
</ul>
<p>Let‚Äôs go ahead and run this command, but we won‚Äôt specify the output file so it goes to the screen. We‚Äôll also disable the progress tracking, just so we have a nicer output for this tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress <span class="p">|</span> cat -n
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     1	{
     2	    &quot;channels&quot;: [
     3	        {
     4	            &quot;name&quot;: &quot;channel1&quot;,
     5	            &quot;samples&quot;: [
     6	                {
     7	                    &quot;data&quot;: [
     8	                        10.0,
     9	                        35.0
    10	                    ],
    11	                    &quot;modifiers&quot;: [
    12	                        {
    13	                            &quot;data&quot;: null,
    14	                            &quot;name&quot;: &quot;SigXsecOverSM&quot;,
    15	                            &quot;type&quot;: &quot;normfactor&quot;
    16	                        }
    17	                    ],
    18	                    &quot;name&quot;: &quot;signal&quot;
    19	                },
    20	                {
    21	                    &quot;data&quot;: [
    22	                        100.0,
    23	                        150.0
    24	                    ],
    25	                    &quot;modifiers&quot;: [
    26	                        {
    27	                            &quot;data&quot;: null,
    28	                            &quot;name&quot;: &quot;lumi&quot;,
    29	                            &quot;type&quot;: &quot;lumi&quot;
    30	                        },
    31	                        {
    32	                            &quot;data&quot;: [
    33	                                10.000000149011612,
    34	                                10.000000521540642
    35	                            ],
    36	                            &quot;name&quot;: &quot;uncorrshape_signal&quot;,
    37	                            &quot;type&quot;: &quot;shapesys&quot;
    38	                        }
    39	                    ],
    40	                    &quot;name&quot;: &quot;bkg&quot;
    41	                }
    42	            ]
    43	        },
    44	        {
    45	            &quot;name&quot;: &quot;channel2&quot;,
    46	            &quot;samples&quot;: [
    47	                {
    48	                    &quot;data&quot;: [
    49	                        200.0,
    50	                        350.0
    51	                    ],
    52	                    &quot;modifiers&quot;: [
    53	                        {
    54	                            &quot;data&quot;: null,
    55	                            &quot;name&quot;: &quot;lumi&quot;,
    56	                            &quot;type&quot;: &quot;lumi&quot;
    57	                        },
    58	                        {
    59	                            &quot;data&quot;: [
    60	                                5.000000074505806,
    61	                                10.000000055879354
    62	                            ],
    63	                            &quot;name&quot;: &quot;uncorrshape_control&quot;,
    64	                            &quot;type&quot;: &quot;shapesys&quot;
    65	                        }
    66	                    ],
    67	                    &quot;name&quot;: &quot;bkg&quot;
    68	                }
    69	            ]
    70	        }
    71	    ],
    72	    &quot;measurements&quot;: [
    73	        {
    74	            &quot;config&quot;: {
    75	                &quot;parameters&quot;: [
    76	                    {
    77	                        &quot;auxdata&quot;: [
    78	                            1.0
    79	                        ],
    80	                        &quot;bounds&quot;: [
    81	                            [
    82	                                0.5,
    83	                                1.5
    84	                            ]
    85	                        ],
    86	                        &quot;fixed&quot;: true,
    87	                        &quot;inits&quot;: [
    88	                            1.0
    89	                        ],
    90	                        &quot;name&quot;: &quot;lumi&quot;,
    91	                        &quot;sigmas&quot;: [
    92	                            0.1
    93	                        ]
    94	                    },
    95	                    {
    96	                        &quot;bounds&quot;: [
    97	                            [
    98	                                0.0,
    99	                                10.0
   100	                            ]
   101	                        ],
   102	                        &quot;inits&quot;: [
   103	                            1.0
   104	                        ],
   105	                        &quot;name&quot;: &quot;SigXsecOverSM&quot;
   106	                    }
   107	                ],
   108	                &quot;poi&quot;: &quot;SigXsecOverSM&quot;
   109	            },
   110	            &quot;name&quot;: &quot;GaussExample&quot;
   111	        }
   112	    ],
   113	    &quot;observations&quot;: [
   114	        {
   115	            &quot;data&quot;: [
   116	                110.0,
   117	                155.0
   118	            ],
   119	            &quot;name&quot;: &quot;channel1&quot;
   120	        },
   121	        {
   122	            &quot;data&quot;: [
   123	                205.0,
   124	                345.0
  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 125	            ],
   126	            &quot;name&quot;: &quot;channel2&quot;
   127	        }
   128	    ],
   129	    &quot;version&quot;: &quot;1.0.0&quot;
   130	}
</pre></div>
</div>
</div>
</div>
<p>Only 130 lines for the entire workspace! Not too shabby. If we look through a couple of pieces:</p>
<ul class="simple">
<li><p>line 2: specify a list of channels</p></li>
<li><p>line 5: specify the samples for <code class="docutils literal notranslate"><span class="pre">channel1</span></code></p></li>
<li><p>lines 6-10: specify the expected event rate for the <code class="docutils literal notranslate"><span class="pre">signal</span></code> sample in <code class="docutils literal notranslate"><span class="pre">channel1</span></code></p></li>
<li><p>line 11: specify a list of modifiers (e.g. parameters that modify the sample)</p></li>
</ul>
<p>Similarly, if we continue down to the second half of this JSON, we hit line 72 which specifies a list of <code class="docutils literal notranslate"><span class="pre">measurements</span></code> for this workspace. In fact, we only have one measurement called <code class="docutils literal notranslate"><span class="pre">GaussExample</span></code> with the parameter of interest defined as <code class="docutils literal notranslate"><span class="pre">SigXsecOverSM</span></code>. This measurement also specifies additional parameter configuration such as details for the luminosity modifier (parameter name <code class="docutils literal notranslate"><span class="pre">lumi</span></code>).</p>
<p>Nearly at the end, the next part of this specification is for the <code class="docutils literal notranslate"><span class="pre">observations</span></code> (observed data) on line 113. Each observation corresponds with the channel, where <code class="docutils literal notranslate"><span class="pre">channel1</span></code> has two bins, and <code class="docutils literal notranslate"><span class="pre">channel2</span></code> also has two bins.</p>
<p>Finally, we have a <code class="docutils literal notranslate"><span class="pre">version</span></code> which specifies the version of the schema used for the JSON HistFactory. In this case, we‚Äôre using <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code> which has the <a class="reference external" href="https://pyhf.readthedocs.io/en/v0.6.0/schemas/1.0.0/workspace.json">https://pyhf.readthedocs.io/en/v0.6.0/schemas/1.0.0/workspace.json</a> definition which refers to the <a class="reference external" href="https://pyhf.readthedocs.io/en/v0.6.0/schemas/1.0.0/defs.json">https://pyhf.readthedocs.io/en/v0.6.0/schemas/1.0.0/defs.json</a>.</p>
<p>What‚Äôs really nice about the schema definition is that it allows anyone to write their own tooling/scripting to build up the workspace and quickly check if it matches the schema. This will get you 90% of the way there in having a valid workspace to work with.</p>
<p>There are some additional checks that cannot be done, such as name conflicts, or ensuring that all samples in a channel have the same binning structure. The good news is that these checks can be done simply by loading up the workspace into a <code class="docutils literal notranslate"><span class="pre">pyhf.Workspace</span></code> object which will do the schema validation, as well as the additional checks.</p>
<p>Speaking of <code class="docutils literal notranslate"><span class="pre">pyhf.Workspace</span></code> objects‚Ä¶</p>
</div>
<div class="section" id="via-the-python-interface">
<h3>via the python interface<a class="headerlink" href="#via-the-python-interface" title="Permalink to this headline">¬∂</a></h3>
<p>Let‚Äôs do the exact same thing, but from the python interpreter</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyhf</span>
<span class="kn">import</span> <span class="nn">pyhf.readxml</span>  <span class="c1"># not imported by default!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spec</span> <span class="o">=</span> <span class="n">pyhf</span><span class="o">.</span><span class="n">readxml</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
    <span class="s2">&quot;data/multichannel_histfactory/config/example.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;data/multichannel_histfactory&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>So we‚Äôre not going to dump this out. We already did that above. Let‚Äôs just quickly go ahead and load it into a <a class="reference external" href="https://pyhf.readthedocs.io/en/v0.6.0/_generated/pyhf.workspace.Workspace.html#pyhf.workspace.Workspace"><code class="docutils literal notranslate"><span class="pre">pyhf.Workspace</span></code></a> object because we can.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">pyhf</span><span class="o">.</span><span class="n">Workspace</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    channels: </span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">channels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;       nbins: </span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">channel_nbins</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     samples: </span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">samples</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   modifiers: </span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">modifiers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  parameters: </span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;observations: </span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">observations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    channels: [&#39;channel1&#39;, &#39;channel2&#39;]
       nbins: {&#39;channel1&#39;: 2, &#39;channel2&#39;: 2}
     samples: [&#39;bkg&#39;, &#39;signal&#39;]
   modifiers: [(&#39;SigXsecOverSM&#39;, &#39;normfactor&#39;), (&#39;lumi&#39;, &#39;lumi&#39;), (&#39;uncorrshape_control&#39;, &#39;shapesys&#39;), (&#39;uncorrshape_signal&#39;, &#39;shapesys&#39;)]
  parameters: [&#39;SigXsecOverSM&#39;, &#39;lumi&#39;, &#39;uncorrshape_control&#39;, &#39;uncorrshape_signal&#39;]
observations: {&#39;channel1&#39;: [110.0, 155.0], &#39;channel2&#39;: [205.0, 345.0]}
</pre></div>
</div>
</div>
</div>
<p>Already, we‚Äôre seeing a lot of information about this workspace as it‚Äôs rather inspectable. Remember, this is not a model. What we call a ‚Äòmodel‚Äô is to combine the channel specification with a measurement‚Ä¶ that is, a measurement of a workspace uniquely defines that model. A model might choose a particular parameter of interest to measure or set specific parameters as constant during the fit. These configurations are all stored in the <code class="docutils literal notranslate"><span class="pre">measurements</span></code> key we saw above. We‚Äôll explore more about models in the next chapter.</p>
<p>Let‚Äôs move on to more things we can do with the command line.</p>
</div>
</div>
<div class="section" id="workspace-inspection">
<h2>Workspace Inspection<a class="headerlink" href="#workspace-inspection" title="Permalink to this headline">¬∂</a></h2>
<p>Now that we have a working command for converting our XML to JSON, let‚Äôs go ahead and take advantage of the JSON output by piping it to <code class="docutils literal notranslate"><span class="pre">pyhf</span> <span class="pre">inspect</span></code> which will print out a nice summary of our workspace.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> pyhf inspect --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: pyhf inspect [OPTIONS] [WORKSPACE]

  Inspect a pyhf JSON document.

  Example:

  .. code-block:: shell

      $ curl -sL https://raw.githubusercontent.com/scikit-
      hep/pyhf/master/docs/examples/json/2-bin_1-channel.json | pyhf inspect
      Summary         ------------------            channels  1
      samples  2          parameters  2           modifiers  2

             channels  nbins          ----------  -----       singlechannel
             2

              samples          ----------          background
              signal

           parameters  constraint              modifiers          ----------
           ----------              ----------                  mu
           unconstrained           normfactor     uncorr_bkguncrt
           constrained_by_poisson  shapesys

          measurement           poi            parameters
          ----------        ----------        ----------     (*) Measurement
          mu            (none)

Options:
  --output-file TEXT  The location of the output json file. If not specified,
                      prints to screen.

  --measurement TEXT
  -h, --help          Show this message and exit.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Summary       
        ------------------  
           channels  2
            samples  2
         parameters  4
          modifiers  4

           channels  nbins
         ----------  -----
           channel1    2  
           channel2    2  

            samples
         ----------
                bkg
             signal

         parameters  constraint              modifiers
         ----------  ----------              ----------
      SigXsecOverSM  unconstrained           normfactor
               lumi  constrained_by_normal   lumi
uncorrshape_control  constrained_by_poisson  shapesys
 uncorrshape_signal  constrained_by_poisson  shapesys

        measurement           poi            parameters
         ----------        ----------        ----------
   (*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
<p>Immediately, we get a lot of useful information. We can see the number of channels, samples, parameters, and modifiers. Then we get a breakdown of the channels (and the number of bins for each channel), the samples, and the parameters. Finally, we see a list of measurements defined in the workspace, as well as the <code class="docutils literal notranslate"><span class="pre">(*)</span></code> denoting the default measurement if one is not specified.</p>
<p><strong>Could the number of parameters and modifiers differ?</strong></p>
</div>
<div class="section" id="normalizing-a-workspace">
<h2>‚ÄúNormalizing‚Äù a Workspace<a class="headerlink" href="#normalizing-a-workspace" title="Permalink to this headline">¬∂</a></h2>
<p>There comes a time when you need to make comparisons to determine changes between two workspaces. This means depending on how the workspace is generated, one might need to ‚Äúsort‚Äù it. <code class="docutils literal notranslate"><span class="pre">pyhf</span> <span class="pre">sort</span></code> is a utility that will normalize the workspace for you, such that certain operations like calculating a checksum (<code class="docutils literal notranslate"><span class="pre">pyhf</span> <span class="pre">digest</span></code>) guarantees unitarity.</p>
<p>For simple workspaces like the ones we‚Äôre using in this tutorial, they‚Äôre already sorted‚Ä¶ however, this is not true in the real world. Notice how the <code class="docutils literal notranslate"><span class="pre">bkg</span></code> is now the first sample and <code class="docutils literal notranslate"><span class="pre">signal</span></code> is the second sample after sorting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> pyhf sort --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: pyhf sort [OPTIONS] [WORKSPACE]

  Sort the workspace.

  See :func:`pyhf.workspace.Workspace.sorted` for more information.

  Example:

  .. code-block:: shell

      $ curl -sL https://raw.githubusercontent.com/scikit-
      hep/pyhf/master/docs/examples/json/2-bin_1-channel.json | pyhf sort |
      jq &#39;.&#39; | md5     8be5186ec249d2704e14dd29ef05ffb0

  .. code-block:: shell

      $ curl -sL https://raw.githubusercontent.com/scikit-
      hep/pyhf/master/docs/examples/json/2-bin_1-channel.json | jq -S &#39;.chan
      nels|=sort_by(.name)|.channels[].samples|=sort_by(.name)|.channels[].s
      amples[].modifiers|=sort_by(.name,.type)|.observations|=sort_by(.name)
      &#39; | md5     8be5186ec249d2704e14dd29ef05ffb0

Options:
  --output-file TEXT  The location of the output json file. If not specified,
                      prints to screen.

  -h, --help          Show this message and exit.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf sort
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    &quot;channels&quot;: [
        {
            &quot;name&quot;: &quot;channel1&quot;,
            &quot;samples&quot;: [
                {
                    &quot;data&quot;: [
                        100.0,
                        150.0
                    ],
                    &quot;modifiers&quot;: [
                        {
                            &quot;data&quot;: null,
                            &quot;name&quot;: &quot;lumi&quot;,
                            &quot;type&quot;: &quot;lumi&quot;
                        },
                        {
                            &quot;data&quot;: [
                                10.000000149011612,
                                10.000000521540642
                            ],
                            &quot;name&quot;: &quot;uncorrshape_signal&quot;,
                            &quot;type&quot;: &quot;shapesys&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;bkg&quot;
                },
                {
                    &quot;data&quot;: [
                        10.0,
                        35.0
                    ],
                    &quot;modifiers&quot;: [
                        {
                            &quot;data&quot;: null,
                            &quot;name&quot;: &quot;SigXsecOverSM&quot;,
                            &quot;type&quot;: &quot;normfactor&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;signal&quot;
                }
            ]
        },
        {
            &quot;name&quot;: &quot;channel2&quot;,
            &quot;samples&quot;: [
                {
                    &quot;data&quot;: [
                        200.0,
                        350.0
                    ],
                    &quot;modifiers&quot;: [
                        {
                            &quot;data&quot;: null,
                            &quot;name&quot;: &quot;lumi&quot;,
                            &quot;type&quot;: &quot;lumi&quot;
                        },
                        {
                            &quot;data&quot;: [
                                5.000000074505806,
                                10.000000055879354
                            ],
                            &quot;name&quot;: &quot;uncorrshape_control&quot;,
                            &quot;type&quot;: &quot;shapesys&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;bkg&quot;
                }
            ]
        }
    ],
    &quot;measurements&quot;: [
        {
            &quot;config&quot;: {
                &quot;parameters&quot;: [
                    {
                        &quot;bounds&quot;: [
                            [
                                0.0,
                                10.0
                            ]
                        ],
                        &quot;inits&quot;: [
                            1.0
                        ],
                        &quot;name&quot;: &quot;SigXsecOverSM&quot;
                    },
                    {
                        &quot;auxdata&quot;: [
                            1.0
                        ],
                        &quot;bounds&quot;: [
                            [
                                0.5,
                                1.5
                            ]
                        ],
                        &quot;fixed&quot;: true,
                        &quot;inits&quot;: [
                            1.0
                        ],
                        &quot;name&quot;: &quot;lumi&quot;,
                        &quot;sigmas&quot;: [
                            0.1
                        ]
                    }
                ],
                &quot;poi&quot;: &quot;SigXsecOverSM&quot;
            },
            &quot;name&quot;: &quot;GaussExample&quot;
        }
    ],
    &quot;observations&quot;: [
        {
            &quot;data&quot;: [
                110.0,
                155.0
            ],
            &quot;name&quot;: &quot;channel1&quot;
        },
        {
            &quot;data&quot;: [
                205.0,
                345.0
            ],
            &quot;name&quot;: &quot;channel2&quot;
        }
    ],
    &quot;version&quot;: &quot;1.0.0&quot;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="computing-a-digest">
<h2>Computing a digest<a class="headerlink" href="#computing-a-digest" title="Permalink to this headline">¬∂</a></h2>
<p>Next up is a way to determine if two workspaces are equivalent, simply by comparing their computed digest. Note that this is based on the contents of the workspace and will not ensure floating-point differences are treated identically. That is, <code class="docutils literal notranslate"><span class="pre">2.19999999</span></code> and <code class="docutils literal notranslate"><span class="pre">2.2000001</span></code> will likely be treated as differently in the digest calculation as in python. We‚Äôll show here why sorting is very important.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> pyhf digest --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: pyhf digest [OPTIONS] [WORKSPACE]

  Use hashing algorithm to calculate the workspace digest.

  Returns:     digests (:obj:`dict`): A mapping of the hashing algorithms
  used to the computed digest for the workspace.

  Example:

  .. code-block:: shell

      $ curl -sL https://raw.githubusercontent.com/scikit-
      hep/pyhf/master/docs/examples/json/2-bin_1-channel.json | pyhf digest
      sha256:dad8822af55205d60152cbe4303929042dbd9d4839012e055e7c6b6459d68d7
      3

Options:
  -a, --algorithm TEXT          The hashing algorithm used to compute the
                                workspace digest.

  -j, --json / -p, --plaintext  Output the hash values as a JSON dictionary or
                                plaintext strings

  -h, --help                    Show this message and exit.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf digest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sha256:50165e8ef034c514fb77e8f05a15a002c02bd659f001657952b79e0552470f79
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf sort | \
  pyhf digest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sha256:27a35f6874cf91f9b38916cf948ac18ee650f1b578a93107b9b212c8752b1310
</pre></div>
</div>
</div>
</div>
<p>Remember that the ordering of the samples will have switched through the sorting.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sha256</span></code> algorithm is used to compute the checksum for this workspace. This means that one can generally ‚Äúnormalize‚Äù all workspaces, then compute the digest and guarantee uniqueness. As with all command line functionality you‚Äôve seen so far, there are equivalent ways to do it through python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsorted: </span><span class="si">{</span><span class="n">pyhf</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sorted:   </span><span class="si">{</span><span class="n">pyhf</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">pyhf</span><span class="o">.</span><span class="n">Workspace</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">ws</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unsorted: 50165e8ef034c514fb77e8f05a15a002c02bd659f001657952b79e0552470f79
Sorted:   27a35f6874cf91f9b38916cf948ac18ee650f1b578a93107b9b212c8752b1310
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pruning-away-items">
<h2>‚ÄúPruning‚Äù away items<a class="headerlink" href="#pruning-away-items" title="Permalink to this headline">¬∂</a></h2>
<p>Sometimes you want to manipulate workspaces by removing channels or samples or systematics (or measurements). This can be useful when trying to debug fits, or to build background-only workspaces, or to clean up a workspace.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pyhf prune --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: pyhf prune [OPTIONS] [WORKSPACE]

  Prune components from the workspace.

  See :func:`pyhf.workspace.Workspace.prune` for more information.

Options:
  --output-file TEXT              The location of the output json file. If not
                                  specified, prints to screen.

  -c, --channel &lt;CHANNEL&gt;...
  -s, --sample &lt;SAMPLE&gt;...
  -m, --modifier &lt;MODIFIER&gt;...
  -t, --modifier-type [histosys|lumi|normfactor|normsys|shapefactor|shapesys|staterror]
  --measurement &lt;MEASUREMENT&gt;...
  -h, --help                      Show this message and exit.
</pre></div>
</div>
</div>
</div>
<div class="section" id="prune-channels">
<h3>prune channels<a class="headerlink" href="#prune-channels" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf prune -c channel1 | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Summary       
        ------------------  
           channels  1
            samples  1
         parameters  2
          modifiers  2

           channels  nbins
         ----------  -----
           channel2    2  

            samples
         ----------
                bkg

         parameters  constraint              modifiers
         ----------  ----------              ----------
               lumi  constrained_by_normal   lumi
uncorrshape_control  constrained_by_poisson  shapesys

        measurement           poi            parameters
         ----------        ----------        ----------
   (*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="prune-samples">
<h3>prune samples<a class="headerlink" href="#prune-samples" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf prune -s signal | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Summary       
        ------------------  
           channels  2
            samples  1
         parameters  3
          modifiers  3

           channels  nbins
         ----------  -----
           channel1    2  
           channel2    2  

            samples
         ----------
                bkg

         parameters  constraint              modifiers
         ----------  ----------              ----------
               lumi  constrained_by_normal   lumi
uncorrshape_control  constrained_by_poisson  shapesys
 uncorrshape_signal  constrained_by_poisson  shapesys

        measurement           poi            parameters
         ----------        ----------        ----------
   (*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="prune-modifiers">
<h3>prune modifiers<a class="headerlink" href="#prune-modifiers" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf prune -m uncorrshape_signal | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Summary       
        ------------------  
           channels  2
            samples  2
         parameters  3
          modifiers  3

           channels  nbins
         ----------  -----
           channel1    2  
           channel2    2  

            samples
         ----------
                bkg
             signal

         parameters  constraint              modifiers
         ----------  ----------              ----------
      SigXsecOverSM  unconstrained           normfactor
               lumi  constrained_by_normal   lumi
uncorrshape_control  constrained_by_poisson  shapesys

        measurement           poi            parameters
         ----------        ----------        ----------
   (*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="prune-modifier-types">
<h3>prune modifier types<a class="headerlink" href="#prune-modifier-types" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf prune -t shapesys | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        Summary       
  ------------------  
     channels  2
      samples  2
   parameters  2
    modifiers  2

     channels  nbins
   ----------  -----
     channel1    2  
     channel2    2  

      samples
   ----------
          bkg
       signal

   parameters  constraint              modifiers
   ----------  ----------              ----------
SigXsecOverSM  unconstrained           normfactor
         lumi  constrained_by_normal   lumi

  measurement           poi            parameters
   ----------        ----------        ----------
(*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="renaming-items">
<h2>Renaming items<a class="headerlink" href="#renaming-items" title="Permalink to this headline">¬∂</a></h2>
<p>In addition to removing items, you might want to rename your channels, samples, modifiers, or measurement names. This can be useful for creating modifier correlations, or removing modifier correlations, or just cleaning up your workspace to get it ready for publication.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> pyhf rename --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: pyhf rename [OPTIONS] [WORKSPACE]

  Rename components of the workspace.

  See :func:`pyhf.workspace.Workspace.rename` for more information.

Options:
  --output-file TEXT              The location of the output json file. If not
                                  specified, prints to screen.

  -c, --channel &lt;PATTERN&gt; &lt;REPLACE&gt;...
  -s, --sample &lt;PATTERN&gt; &lt;REPLACE&gt;...
  -m, --modifier &lt;PATTERN&gt; &lt;REPLACE&gt;...
  --measurement &lt;PATTERN&gt; &lt;REPLACE&gt;...
  -h, --help                      Show this message and exit.
</pre></div>
</div>
</div>
</div>
<div class="section" id="rename-channels">
<h3>rename channels<a class="headerlink" href="#rename-channels" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf rename -c channel1 SR -c channel2 CR | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Summary       
        ------------------  
           channels  2
            samples  2
         parameters  4
          modifiers  4

           channels  nbins
         ----------  -----
                 CR    2  
                 SR    2  

            samples
         ----------
                bkg
             signal

         parameters  constraint              modifiers
         ----------  ----------              ----------
      SigXsecOverSM  unconstrained           normfactor
               lumi  constrained_by_normal   lumi
uncorrshape_control  constrained_by_poisson  shapesys
 uncorrshape_signal  constrained_by_poisson  shapesys

        measurement           poi            parameters
         ----------        ----------        ----------
   (*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="rename-samples">
<h3>rename samples<a class="headerlink" href="#rename-samples" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf rename -s bkg background | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Summary       
        ------------------  
           channels  2
            samples  2
         parameters  4
          modifiers  4

           channels  nbins
         ----------  -----
           channel1    2  
           channel2    2  

            samples
         ----------
         background
             signal

         parameters  constraint              modifiers
         ----------  ----------              ----------
      SigXsecOverSM  unconstrained           normfactor
               lumi  constrained_by_normal   lumi
uncorrshape_control  constrained_by_poisson  shapesys
 uncorrshape_signal  constrained_by_poisson  shapesys

        measurement           poi            parameters
         ----------        ----------        ----------
   (*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="rename-modifiers">
<h3>rename modifiers<a class="headerlink" href="#rename-modifiers" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf rename -m uncorrshape_signal corrshape -m uncorrshape_control corrshape | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        Summary       
  ------------------  
     channels  2
      samples  2
   parameters  3
    modifiers  3

     channels  nbins
   ----------  -----
     channel1    2  
     channel2    2  

      samples
   ----------
          bkg
       signal

   parameters  constraint              modifiers
   ----------  ----------              ----------
SigXsecOverSM  unconstrained           normfactor
    corrshape  constrained_by_poisson  shapesys
         lumi  constrained_by_normal   lumi

  measurement           poi            parameters
   ----------        ----------        ----------
(*) GaussExample      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="rename-measurements">
<h3>rename measurements<a class="headerlink" href="#rename-measurements" title="Permalink to this headline">¬∂</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! pyhf xml2json --basedir data/multichannel_histfactory data/multichannel_histfactory/config/example.xml --hide-progress | \
  pyhf rename --measurement GaussExample FitConfig | \
  pyhf inspect
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Summary       
        ------------------  
           channels  2
            samples  2
         parameters  4
          modifiers  4

           channels  nbins
         ----------  -----
           channel1    2  
           channel2    2  

            samples
         ----------
                bkg
             signal

         parameters  constraint              modifiers
         ----------  ----------              ----------
      SigXsecOverSM  unconstrained           normfactor
               lumi  constrained_by_normal   lumi
uncorrshape_control  constrained_by_poisson  shapesys
 uncorrshape_signal  constrained_by_poisson  shapesys

        measurement           poi            parameters
         ----------        ----------        ----------
      (*) FitConfig      SigXsecOverSM       lumi,SigXsecOverSM
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="IntroToHiFa.html" title="previous page">HistFactory</a>
    <a class='right-next' id="next-link" href="Modifiers.html" title="next page">Modifiers</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By the pyhf development team<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>